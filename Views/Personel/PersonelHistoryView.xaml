<UserControl x:Class="CAKA.PerformanceApp.Views.Personel.PersonelHistoryView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d" d:DesignHeight="500" d:DesignWidth="600">
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="0,0,0,24">
            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,16">
                <Grid>
                    <TextBlock Text="İş geçmişi (haftalık)" Style="{StaticResource TitleTextStyle}" VerticalAlignment="Center"/>
                    <Button Content="Yenile" Command="{Binding RefreshCommand}" HorizontalAlignment="Right"
                            Padding="14,8" Background="{StaticResource BorderBrush}" Foreground="{StaticResource TextPrimaryBrush}"/>
                </Grid>
            </Border>

            <ItemsControl ItemsSource="{Binding WeekGroups}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Expander Margin="0,0,0,12" BorderBrush="{StaticResource BorderBrush}" BorderThickness="1"
                                  Background="{StaticResource CardBackgroundBrush}">
                            <Expander.Header>
                                <Grid Margin="16,12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" MinWidth="120"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="{Binding DisplayTitle}" Style="{StaticResource TitleTextStyle}" FontSize="16" VerticalAlignment="Center"
                                               TextTrimming="CharacterEllipsis" Margin="0,0,12,0"/>
                                    <TextBlock Grid.Column="1" Text="{Binding Entries.Count, StringFormat='{}{0} kayıt'}" Style="{StaticResource SubtitleTextStyle}"
                                               VerticalAlignment="Center"/>
                                </Grid>
                            </Expander.Header>
                            <Border Padding="16,0,16,16" BorderThickness="0">
                                <StackPanel>
                                    <DataGrid ItemsSource="{Binding Entries}" AutoGenerateColumns="False"
                                              IsReadOnly="{Binding IsCurrentWeek, Converter={StaticResource InverseBooleanConverter}}"
                                              CanUserAddRows="False" CanUserDeleteRows="False" HeadersVisibility="Column"
                                              RowHeight="36" BorderThickness="0"
                                              BorderBrush="{StaticResource BorderBrush}">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Tarih" Binding="{Binding Date, StringFormat='{}{0:dd.MM.yyyy}'}" Width="90" MinWidth="90" IsReadOnly="True"/>
                                            <DataGridTextColumn Header="Gün" Width="85" MinWidth="85" IsReadOnly="True">
                                                <DataGridTextColumn.Binding>
                                                    <Binding Path="Date" StringFormat="{}{0:dddd}"/>
                                                </DataGridTextColumn.Binding>
                                            </DataGridTextColumn>
                                            <DataGridTextColumn Header="Açıklama" Binding="{Binding Description, UpdateSourceTrigger=PropertyChanged}" Width="*" MinWidth="200">
                                                <DataGridTextColumn.ElementStyle>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                                        <Setter Property="ToolTip" Value="{Binding Description}"/>
                                                    </Style>
                                                </DataGridTextColumn.ElementStyle>
                                            </DataGridTextColumn>
                                            <DataGridTemplateColumn Header="Saat" Width="80" MinWidth="60">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding Hours, StringFormat='{}{0:N1}'}" VerticalAlignment="Center"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                                <DataGridTemplateColumn.CellEditingTemplate>
                                                    <DataTemplate>
                                                        <TextBox Text="{Binding Hours, UpdateSourceTrigger=LostFocus, Converter={StaticResource DecimalToStringConverter}, Mode=TwoWay}"
                                                                 Padding="6,4" BorderThickness="0" Background="Transparent"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellEditingTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTemplateColumn Header="" Width="50" IsReadOnly="True">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <Button Content="Sil" Command="{Binding DataContext.DeleteEntryCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                                CommandParameter="{Binding}"
                                                                Visibility="{Binding DataContext.IsCurrentWeek, RelativeSource={RelativeSource AncestorType=DataGrid}, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                                Padding="8,4" FontSize="12" Background="#E57373" Foreground="White" BorderThickness="0"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                    <Button Content="Değişiklikleri kaydet" Command="{Binding DataContext.SaveWeekEditsCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            CommandParameter="{Binding}"
                                            Visibility="{Binding IsCurrentWeek, Converter={StaticResource BooleanToVisibilityConverter}}"
                                            Margin="0,12,0,0" Padding="14,8" HorizontalAlignment="Left"
                                            Background="{StaticResource AccentBrush}" Foreground="White"/>
                                    <TextBlock Margin="0,12,0,0" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}">
                                        <Run Text="Toplam çalışma süresi: "/>
                                        <Run Text="{Binding EntriesTotalHours, StringFormat='{}{0:N1} saat', Mode=OneWay}"/>
                                    </TextBlock>
                                </StackPanel>
                            </Border>
                        </Expander>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </StackPanel>
    </ScrollViewer>
</UserControl>
